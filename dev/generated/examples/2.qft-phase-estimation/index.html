<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li><li><a class="tocitem" href="../9.noisy-simulation/index.html">Noisy Simulation</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  -0.232358-0.0196578im   -0.0818634-0.00389088im   -0.104852+0.311729im     0.0772131-0.193564im     0.0894109-0.095355im     0.00576002-0.0121719im     0.0164606+0.0547623im     0.0599838+0.0784483im   -0.0302759-0.0816036im      0.122923-0.0537066im   -0.0283837+0.131349im       0.0705131+0.0151022im        0.13627-0.0767315im      0.177346+0.0332408im     -0.256206-0.144274im     0.0978479-0.195272im       0.0076655-0.0685561im      0.135052-0.162105im      -0.190798-0.0147512im   -0.193521-0.091188im    -0.0429706-0.0639329im     0.0632416-0.0512158im    -0.0573992-0.0619029im   -0.0132938-0.16581im         0.108533-0.179457im        0.13419+0.0955144im      -0.101158+0.115747im      -0.152112-0.113155im      -0.350801+0.0521161im    -0.0675403-0.0833134im    0.202824+0.163062im       0.0449484-0.0168651im
  -0.107632-0.162812im     -0.179257+0.00653101im  -0.0460759+0.0828978im   -0.0989979+0.233428im    -0.0803758-0.243658im     -0.0134697+0.303232im       0.108573+0.00637998im    0.0213426-0.164588im      0.227183-0.0528912im   -0.00678888-0.0523516im   3.12901e-5-0.0305685im    -0.00856134+0.131392im       0.0785391-0.0303392im      0.152147+0.148542im       0.200713-0.0986558im    -0.189802+0.0804996im     -0.0370504+0.0517209im     0.0411631-0.0647437im     0.0689044+0.166182im     0.119504-0.022153im     0.0872628-0.136517im      0.0228845-0.0548124im     0.0649226+0.0122518im    -0.280239-0.0975344im      -0.123908-0.148599im      0.0384957+0.135456im      0.00224296-0.134872im       0.114206+0.0219985im     -0.101265-0.0264567im      0.315767+0.105641im     0.147365-0.106985im       -0.118663+0.0387716im
   0.055158-0.146275im     0.0669827+0.110877im     -0.252952-0.0328827im    -0.103653+0.078861im     0.0759701+0.351092im      0.0849211-0.110254im       0.123584+0.00563784im   -0.0210741-0.199061im   -0.00925053-0.107242im      -0.034313-0.127156im    -0.0438443-0.0653897im       0.171744-0.0605895im     -0.0393017+0.314311im       0.127395-0.115187im      0.0700274-0.153524im    -0.0756125-0.0748629im       0.102528-0.00937586im   -0.0199129+0.0733192im     -0.114479+0.283992im    0.0460213+0.152391im      0.116759+0.24964im        0.103259+0.0145246im    -0.0305595+0.0504926im    0.0892343+0.0548456im       0.110791-0.0807052im      0.175305-0.145264im       -0.107227-0.000803664im   0.0422337-0.0459882im     -0.157913+0.0958702im    0.00397248+0.0411785im   0.0828345-0.205812im        0.066748-0.150877im
  0.0393998+0.032021im    -0.0960516+0.118501im    -0.0517726+0.241033im     -0.196912+0.301815im    -0.0992302+0.0710047im    -0.0890852+0.105699im      0.0854722+0.0750585im     0.0158666+0.0806485im     0.105364+0.130711im        0.10748-0.0863366im   -0.0548158+0.192669im        0.054163-0.0217072im     -0.0493931+0.0148064im     -0.159813-0.297167im      0.0191737-0.191846im      0.112879+0.0375034im      0.0880977+0.0126799im     -0.085817-0.0951327im    -0.0971236-0.154254im    -0.094727+0.0562433im    -0.083853+0.0464087im     -0.177863+0.149723im      0.0554469+0.0759483im    0.0180684-0.0780152im      0.0843703+0.228211im      -0.131216-0.0273023im       0.157203+0.140153im     -0.0738771-0.100769im      -0.187606+0.00519558im    0.0112361+0.186518im    -0.166257-0.0739717im      -0.263467+0.115229im
  0.0516972-0.168703im    -0.0586435+0.201866im      0.141534-0.140202im     0.0964533-0.0540009im    -0.327281+0.0145218im      0.108241-0.0268822im       0.17439-0.128543im     0.00445581-0.0634247im   -0.0376017-0.0959531im      0.115778+0.102905im     -0.140051+0.211364im      -0.0906298-0.0606684im      0.0517593+0.00840544im    -0.178221+0.0175028im      0.080344+0.004381im     0.0405804-0.0446926im      -0.133197-0.0371329im      0.124315-0.0874295im      0.210529-0.0863158im  0.00349229+0.0393733im    0.0214226+0.0137429im       0.39867-0.160114im       0.115625+0.118837im    -0.0472612-0.291895im       0.0999916+0.13603im       0.0964466-0.156698im       -0.116469+0.0979162im     -0.038034+0.114955im       -0.02555+0.00569459im    -0.119659+0.0936986im   0.0387329+0.0315671im      -0.122438-0.0956438im
  0.0752573-0.0581164im    -0.220388+0.176353im     -0.151264+0.0728286im   -0.0784792-0.212454im     0.0549586-0.014715im      -0.150835+0.0382619im      0.145349+0.267448im      0.0167388-0.121324im    -0.0830718-0.103402im     -0.0733851-0.0805852im    0.0503134-0.0536588im      -0.301017+0.00952267im    -0.0954631+0.13825im      -0.0844351-0.0230854im     -0.122399+0.00840896im  -0.0357474-0.00525992im      0.105635+0.0534212im     0.0479274+0.00788291im    0.0632776-0.016014im     0.103136-0.0292363im    -0.198667+0.0488428im     0.0478292-0.00187782im    0.0815853+0.137152im    -0.0883439+0.045221im       0.0515368+0.0966785im     -0.400276+0.0500747im      -0.222478+0.148111im      0.0506527+0.0886191im     0.0534462+0.151623im       0.121607-0.289302im    0.0904857-0.0066947im      0.0671771+0.116723im
  0.0571159+0.00844388im  -0.0538902+0.158332im     0.0661549+0.0441582im    0.0564147-0.0179527im     0.309984-0.118649im      0.0090349-0.0241387im     -0.241193+0.0762653im     -0.110194+0.178454im      0.260316-0.226691im      0.0993617+0.177731im     -0.102405-0.0436836im       0.161966+0.09218im        -0.157719+0.161128im      -0.194874+0.0318103im     0.0988802-0.0271748im    -0.122335+0.123841im       -0.255581-0.214891im    -0.00769949+0.156436im    -0.00368938-0.0364937im  -0.0977534-0.0346209im   -0.0146778+0.0646764im     -0.111346-0.14452im     -0.00949774-0.0619821im   -0.0670408+0.0635675im      0.0839022+0.0832524im      0.035373-0.0255933im     -0.0653628+0.0574598im     0.0879596+0.123573im     -0.0810303+0.133535im      -0.162963+0.0124449im    0.238417-0.120573im       -0.128375+0.134016im
   0.259597-0.0265012im     0.201479+0.0511106im   -0.0510562+0.0692957im    0.0521365+0.212935im     -0.151701+0.0403753im     -0.160282-0.180704im      0.0670375-0.0127139im     -0.123833-0.0564592im   -0.0172601+0.120617im     0.00641238-0.166757im     -0.122806+0.0875229im      -0.031185+0.00134164im     0.0352275+0.0827837im      0.134388+0.133811im      0.0203063+0.211079im    -0.0432332+0.0199749im     -0.0798885+0.0360055im     0.0654358+0.0950026im    -0.0070438-0.0241234im  -0.0789288-0.357871im    -0.0783265-0.182497im     -0.0339096-0.0362325im    -0.0534568+0.280251im    0.00938025+0.0807785im     -0.0108867-0.138935im     -0.0674888-0.0215598im      0.0124999-0.290662im     -0.0705743+0.0593005im     -0.222781+0.1603im        -0.221922-0.0748223im   0.0394472-0.00398584im    -0.0587356+0.175364im
    0.15851+0.139332im     -0.029151+0.0110904im    0.0417355+0.0816751im     0.121104-0.163315im        0.1261+0.0239142im    -0.0770449+0.115321im       0.206386-0.179842im     -0.0214252-0.322857im     -0.192049+0.0871336im      0.217154-0.13102im       0.114067-0.14867im         0.156586-0.0399327im     -0.0724186-0.0395111im     0.0305525+0.0205035im      0.228862-0.109966im    -0.0769341+0.0841698im      -0.169261+0.01138im        0.179277+0.171394im      -0.147141+0.0306009im  -0.0661016-0.00919177im    0.104106-0.0776083im     -0.144745-0.134099im      0.0786819-0.0172516im     0.128367-0.204447im       -0.100937+0.263469im      0.0952003+0.0212242im      0.0960466+0.115432im      -0.090861-0.0200134im     0.0258554+0.0917826im     0.0980593-0.141632im   -0.0530787+0.128668im       0.0159353+0.130857im
  0.0154559+0.138712im     -0.015587-0.069278im     0.0563879-0.0497354im      0.05763-0.0034144im    -0.142601-0.0270658im      0.168768+0.0260476im      0.186613+0.0284067im    -0.0962092+0.177645im     -0.190073-0.0139276im      -0.40031-0.0824968im    -0.157426-0.130091im       0.0905856+0.000584577im   -0.0998449+0.0439807im   -0.00396909-0.120646im      -0.103888-0.120021im     -0.096127-0.0971527im      -0.142308-0.0501949im      0.045392+0.247843im      -0.266279-0.20579im    -0.0337228-0.056534im     0.0489771-0.0145897im    -0.0797926+0.0197659im      0.129434-0.0128967im   -0.0435409-0.216153im      -0.0677821-0.21397im       -0.148516-0.0456794im     -0.0537532+0.0447568im      0.272317+0.194951im     -0.0989487-0.0834036im     0.0749259+0.0790933im  -0.0100483+0.0313816im     -0.0804653-0.0983544im
  0.0266967+0.140859im      0.131665-0.0322266im    0.0316409-0.0637798im   -0.0304642-0.0911252im   0.00170931+0.0711088im      0.157791+0.0254004im    0.00703515-0.0039008im      0.164125-0.0204253im     0.164456-0.0121178im      0.153569-0.017687im     -0.202742-0.172491im      -0.0125453+0.0908175im        0.18191+0.00653623im   0.00912962-0.206132im       0.151074+0.0211573im    0.0133586-0.0864268im      0.0861447-0.165007im       0.179394-0.226989im     -0.0789166+0.162548im     0.138682+0.144669im     -0.113968-0.309771im      0.0325156-0.0623632im     0.0250355-0.021181im       0.12901+0.115697im       0.0565389-0.170673im     -0.0925451+0.0152706im     -0.0416921+0.138611im       0.102251+0.30607im      -0.0817504-0.0522402im    -0.0661237-0.0139105im   -0.218958-0.0128248im   -0.000169995+0.295486im
   0.113131-0.016229im     -0.198851+0.0551583im    0.0473334+0.0541881im    0.0231494+0.0728006im    0.0138492-0.0710025im     0.0423058+0.101471im    -0.00558196-0.168951im       0.117837+0.0219514im     -0.12325+0.0389646im      0.190912-0.0551845im      0.20361+0.0021403im      -0.393632+0.0660622im      0.0316666+0.0357845im    -0.0297634-0.100198im     -0.0238163-0.127221im      0.202337-0.143402im       -0.147102-0.0186334im     -0.130607+0.150908im     -0.0226292+0.322161im    -0.174219-0.194138im    -0.0936697+0.0305118im    -0.0486714-0.082179im      0.0615107-0.249838im     0.0964008+0.074615im       0.0177426-0.126334im     0.00500176-0.164801im      -0.0695649-0.146052im       0.226596-0.0154892im    0.00939243-0.116907im       -0.13582-0.0286374im  -0.0755656-0.0986293im      -0.124473-0.0736164im
 -0.0265984-0.111353im       0.25078+0.0660375im    -0.400663+0.264892im     0.0239991-0.0172234im     -0.20012-0.0250941im      0.224891+0.178198im     -0.0744782+0.00364738im    -0.205606+0.16468im      0.0812025+0.0619548im      0.213832+0.0255309im    0.0389668+0.0202053im     -0.0619775-0.161638im       -0.261896-0.159478im     -0.0695769+0.0336469im     0.0911339+0.158103im     0.0488368-0.234215im       -0.160829-0.0839719im     0.0105964+0.0144185im    -0.0657793+0.0552657im   0.0934669+0.0920242im     0.119912-0.0251973im    0.00736139+0.077288im     -0.0973855-0.0214306im    0.0347434-0.0702844im      -0.174861+0.0285112im       -0.1118+0.0421039im     -0.0519555-0.000719656im    0.108943+0.021318im       0.107833+0.149609im      0.0112815-0.0711915im  -0.0430158-0.0315814im      0.0930686-0.0671746im
 -0.0849358-0.229147im     -0.171913-0.134357im    -0.0544929+0.0126096im      0.21915-0.0392141im   -0.0996944-0.07315im      -0.0105763+0.0119773im     -0.091536-0.0749895im      0.151986-0.183294im     -0.191512+0.148951im      -0.089178-0.14131im      0.0766859+0.0703991im       0.235204-0.194793im      -0.0823169+0.106169im      -0.361559+0.0275166im       0.17902+0.0141439im   -0.0125206-0.0699712im       0.139166-0.075756im      -0.113461+0.0528185im     0.0484876-0.0665604im   0.0462591+0.0254903im    -0.038009-0.284374im     -0.0953346+0.0759879im    -0.0362358-0.0602635im   -0.0693009+0.120661im       0.0185411-0.145343im    -0.00197963+0.151688im      -0.0558811+0.147845im     -0.0442461+0.00510395im   -0.0511096-0.080904im      -0.225565-0.0658612im    0.104291-0.234796im      -0.0333478-0.0354348im
 -0.0753815+0.0404945im    -0.030447-0.250579im     -0.120438-0.0174717im     0.163761+0.0310769im     -0.21953+0.0872471im     -0.205077-0.0562055im      0.315325-0.000545051im  -0.0408645-0.10651im       0.227685+0.0221744im      0.217037+0.156259im    -0.0111361-0.106034im      -0.0348159+0.0515151im     -0.0526933+0.119089im      -0.109681+0.0269956im     -0.391247-0.0307865im    -0.128096-0.0466428im     -0.0789671-0.0940514im     0.0492185-0.0464837im      0.168957+0.0239125im  -0.0814405+0.0456023im    0.0248077-0.012079im      -0.390433+0.0132906im    -0.0214899+0.0278856im    -0.099012+0.0240794im       0.129395+0.0297121im      0.154647+0.000290117im   -0.0508366-0.0043199im     0.0621914+0.159542im      0.0706802-0.0422325im    -0.0168811+0.0329379im  -0.0652764-0.0119639im      0.0988549-0.114916im
 -0.0103121-0.157729im     0.0448693+0.258478im     0.0193744-0.0102757im    0.0518447+0.102804im    -0.0744323-0.038773im     -0.0722227-0.036474im      0.0728191-0.0751838im     0.0449508+0.119894im     0.0500696-0.113545im     -0.0437468+0.128188im    -0.0725555-0.0815176im     -0.0496223-0.23722im        0.0529308-0.227953im       0.101696+0.130375im      0.0435219-0.0046675im    -0.442336+0.0844949im      0.0563786+0.133772im       -0.32382+0.0146559im     -0.157198+0.152426im   -0.0382431+0.104408im      -0.10173-0.099841im      -0.192418-0.0464256im   -0.00291462-0.0508282im     0.214054-0.105478im        0.174639-0.0125316im    -0.0965107-0.045719im        -0.16128+0.112868im      -0.105681-0.0473347im    0.00272436-0.158594im     -0.0851911-0.103742im   -0.0520443+0.117329im      -0.0224861-0.0207935im
  0.0907662-0.243494im     -0.042156+0.0599276im     0.122107-0.256063im     0.0863615-0.118341im     0.0152257+0.0947026im     0.0193754+0.0160402im    -0.0904119+0.178671im     -0.0984309-0.0285044im   -0.0205342+0.0893616im      0.143116+0.0451695im   0.00739237+0.0695647im      0.0200607+0.0730782im     -0.0248242+0.0361949im      0.172566-0.208018im      0.0309925-0.158349im    -0.0898882-0.0488877im      -0.310298-0.0893261im     -0.116059-0.118816im     -0.0301468+0.0197128im  -0.0452043-0.110812im     0.0639118-0.0275709im     -0.022393+0.19542im      -0.0574592+0.137809im    -0.0329723+0.0817833im      0.0592808-0.253291im     -0.0386248+0.245983im        0.103713+0.114196im      -0.146615-0.0092272im      0.150662+0.136815im       0.122755-0.140787im    -0.158557+0.0982797im      -0.255289-0.198191im
  0.0837511+0.0911025im     0.129051+0.0995528im    -0.242973+0.170917im      0.264985-0.244474im     -0.100273-0.267416im     -0.0326022-0.121153im      -0.137181-0.148853im       0.259095-0.150953im      0.178737+0.136764im      -0.172052-0.0780157im    -0.145784+0.0283534im      0.0180555+0.187087im        0.183032+0.0158303im      0.123984-0.0553828im    -0.0569397-0.0653998im    0.0954454+0.0259668im     -0.0937269-0.00342589im     -0.30515+0.0715319im     -0.122163+0.0252856im   0.0905201+0.0498261im    0.0410934+0.0462635im     0.0340444+0.0114292im      0.116585+0.18507im     -0.0790595+0.08185im        0.0930814+0.203125im      0.0294592-0.0114862im      0.0202837+0.0281929im     0.0861859+0.023125im       0.131148+0.025208im      0.0220624+0.0748706im   0.0129305+0.00317482im    -0.0880216-0.0856994im
  -0.151413-0.110936im     -0.152008-0.0557256im    0.0192731-0.0329116im    -0.102386+0.267436im    -0.0538904-0.0174861im   -0.00861254-0.135969im       -0.19029-0.132114im      -0.168671-0.211735im     -0.118702-0.266529im      0.0241239-0.0556612im    -0.150546+0.0427318im     -0.0958534+0.141584im       -0.079759+0.0123756im    -0.0140744+0.0899476im     -0.176693+0.014908im      0.159353+0.000103718im   -0.0026902-0.152771im      0.0931579+0.0800184im     -0.369371+0.121328im   -0.0719667+0.19236im     -0.0386123-0.167489im     -0.0221378-0.0841117im    -0.0380072+0.236468im     0.0552578+0.062678im       -0.150552+0.0679216im    -0.0562711+0.0589178im     -0.0381266+0.0855839im    -0.0882237-0.0169364im      0.282376-0.069081im     -0.0224349+0.101308im    0.0411615+0.0916268im     -0.0522437+0.0113733im
  -0.242723+0.240842im    -0.0342965-0.0270643im    -0.114301-0.153503im     -0.116934-0.0783446im    -0.208748+0.00225494im   -0.0334532+0.00739261im   -0.0213626+0.0272806im     -0.075991+0.0486662im   -0.0193355+0.0311788im     0.0647036-0.0798059im    0.0856838-0.061739im       0.0928886-0.0041759im       0.153441+0.119887im     -0.0696366-0.118084im       0.132118+0.0301659im      -0.1476+0.144841im      -0.0571909-0.344303im      -0.121055+0.02306im      -0.0358131+0.165165im     -0.20533-0.153466im     0.0820512-0.0609866im      0.147446+0.108254im      0.0236422+0.0210284im     -0.19372-0.147639im        0.160677+0.0135567im     -0.200219-0.0902674im     -0.0848604-0.0970939im     -0.023769-0.322639im        0.13927-0.00325531im   -0.0661241+0.0428744im  -0.0032604+0.0557264im       0.194296+0.153527im
 -0.0521925-0.0987364im     0.227143+0.0594518im   -0.0195599+0.00995723im   -0.110607+0.0506983im    0.0900696+0.0278804im    -0.0978348-0.0590928im    0.00994655+0.00980336im     0.123605-0.0347313im   -0.0270747-0.0852017im      0.110053+0.0355981im   -0.0629365-0.057482im        0.183845+0.0942186im        0.18177+0.102074im     0.00541721+0.0280691im     0.0178876+0.0564275im    0.0332335-0.136865im     -0.00466035-0.090411im      0.0114915+0.157061im     -0.0405692-0.106045im   -0.0183562+0.0478108im    -0.497115-0.106599im      0.0134125+0.117057im      0.0291154-0.252761im     -0.197122-0.261811im       -0.100932+0.0905848im    -0.0380397-0.0722049im      0.0225637-0.204833im      -0.125163+0.0726317im      0.122521+0.027575im       0.109003-0.171909im    -0.104182-0.134631im      -0.0707431-0.258613im
   0.104516-0.0406466im     0.122376+0.142407im    -0.0403997+0.139675im     0.0110838-0.0239397im   0.00459842-0.0827275im      0.248811-0.0296983im    -0.0512111+0.104009im      0.0515204-0.183413im     0.0188873-0.0815537im     -0.120469+0.0447662im     0.419679+0.0442287im    -0.00721594-0.100281im       0.0408462+0.186296im     -0.0552918-0.146058im    -0.00013853+0.17459im     0.00921899+0.296074im      -0.0484193-0.141165im       0.169155-0.215889im      -0.040315-0.0835983im  0.00488336+0.124596im      -0.10672+0.0480506im     -0.237344-0.112917im      0.0352592+0.127745im    -0.0168261-0.0795912im     -0.0355593-0.136625im      0.0452316-0.00830868im     -0.087703-0.174054im      0.0404907-0.0778815im    -0.0329375-0.206285im     -0.0405049+0.0247069im  -0.0587958+0.227961im      -0.0849689-0.123879im
  0.0680613-0.017659im    -0.0125067-0.0228398im     0.124717+0.138448im       0.15191-0.208898im     0.0674168+0.144006im      0.0316316+0.0338092im      0.239449+0.0548034im      -0.20651+0.053515im    -0.0945327+0.0578981im     0.0653391+0.144611im     0.0609397+0.0716072im       0.087807+0.178638im        0.127531-0.132057im     -0.0590225+0.0212714im  -0.000332673-0.169642im     0.0511326+0.123233im       0.0828861-0.012089im       -0.14865-0.0370855im    -0.0697996+0.0455163im  -0.0112261+0.213072im    -0.0574097-0.0867006im     0.0785645-0.0711588im     -0.413421+0.199949im     0.0637883-0.0823798im      0.0213529+0.00607179im    -0.198806+0.0291887im      0.0949193-0.284909im       0.162452+0.00331801im    0.0539305-0.13607im      -0.0210721+0.0118856im    0.170876-0.229284im      -0.0369463+0.0125214im
    0.21343+0.0429028im   -0.0421825-0.0411305im   -0.0567459+0.0323113im     0.024963+0.00649358im  -0.0070705+0.201067im        -0.1087+0.11318im       -0.177235+0.212124im      0.0725052-0.0241924im   -0.0592972-0.182192im      -0.118698+0.0111788im   -0.0655693-0.128403im      0.00301707-0.0837574im    -0.00400429-0.0289003im      0.121908+0.227541im     -0.0596402-0.0262955im     0.139782-0.057014im        0.103703-0.0948707im     -0.178825-0.132345im       0.108741+0.0497346im   -0.180212+0.141984im      0.205325+0.00990897im  -0.00970457-0.029025im       0.104432+0.0513959im    -0.220964-0.308281im       -0.127641-0.00897351im     0.125288+0.0700574im      0.0806251+0.00146744im     0.151611-0.0259057im     0.0343392-0.0394266im     -0.260939-0.210457im    -0.219898-0.0637745im      -0.159024+0.163833im
   0.177538-0.10456im      0.0708673+0.047139im       0.10608+0.0517079im   -0.0369259-0.0745118im    -0.100886+0.00424437im     -0.14112+0.0291149im   -0.00616035-0.15291im       0.0764357+0.110492im      0.117982+0.00937983im     0.025115-0.0267139im    0.0507434+0.205776im       0.0260726+0.0219482im      0.0295535+0.174968im      0.0794112+0.0459187im    -0.0517435-0.22216im     -0.0944482-0.076829im        -0.03382-0.225823im     0.00682476-0.043076im     -0.0287476-0.0637201im    0.102105-0.0311354im     0.122876+0.171898im      -0.035773+0.0943887im    -0.0287244-0.0131773im   -0.0301831+0.0540165im      -0.418428-0.0826425im     -0.107509-0.234662im     -0.00471943+0.109583im      -0.225347+0.074169im      0.0463073-0.374685im      0.0152861-0.137838im     0.106899-0.0430435im       0.181772+0.184169im
 -0.0188386+0.00480373im  -0.0818116-0.0925521im   -0.0561587+0.0807im       -0.138924-0.0379284im      0.04369-0.0827169im      0.310471-0.206482im       0.138604-0.012783im      0.0374798-0.062174im     -0.074981+0.0888116im     0.0451567+0.0721351im    0.0435374+0.156027im        0.252823+0.0607676im      -0.148738-0.0242738im      0.155281+0.346709im     -0.0181497-0.0665073im   0.00870264+0.0958395im       0.076542-0.105814im     -0.0519418-0.0659413im      0.191691+0.149212im    -0.223851+0.0474894im    0.0524027+0.019764im     0.00788244+0.176265im       0.253359-0.0990504im    0.0974924+0.119089im       0.0161682+0.0381328im     -0.305326-0.0829883im    -0.00388784-0.0615597im     -0.044553+0.256668im     0.00275952+0.0622787im    -0.0184021+0.0301007im   -0.033801+0.119324im       -0.155172-0.0192059im
   0.164426-0.0105646im    0.0298694+0.0335509im   0.00808077+0.0581188im    -0.192492-0.0304289im   -0.0152762+0.104261im      0.0931692+0.0732165im     -0.117717+0.0880072im       -0.0342+0.050911im     -0.192516+0.154835im      0.0347639-0.0645109im   -0.0220854+0.170253im      0.00814892+0.0529197im       0.174227+0.0817321im    -0.0789608+0.0669351im      -0.12731+0.0620934im   -0.0311574+0.161497im        0.102958-0.0462512im     -0.182066+0.0447249im    -0.0331636+0.0359853im   0.0202266-0.185882im     0.0904679-0.0873568im     -0.067253+0.0370305im     -0.222626-0.130886im     0.0014389-0.107359im    -0.000584556+0.123603im       0.300043+0.131407im       -0.442844+0.0742676im    0.00115295+0.284627im      0.0902101+0.0344532im      0.217924+0.154127im    -0.034491+0.0556532im     -0.0153714+0.0990378im
  -0.149324-0.169296im     -0.109074-0.0111076im     0.122783-0.0418685im    0.0886026-0.0905152im   -0.0597541+0.0921331im    -0.0549701+0.0240585im      0.178921+0.199624im      0.0322301+0.0390977im     0.249437+0.155432im      -0.106638-0.278532im     -0.204667+0.0507715im      0.0824607+0.0298739im      -0.124306+0.0332957im     0.0187001+0.0707581im    -0.0510278+0.226835im      0.274416+0.283112im       -0.122198-0.0642189im    -0.0574504-0.0511489im     -0.129756+0.129957im     0.149491-0.00977279im   0.0613625+0.0625405im    -0.0463202-0.28503im      -0.0668708-0.3085im       0.0820214-0.0548788im     -0.0732301-7.30432e-5im    -0.103714-0.0934403im     -0.0282611-0.0252464im    -0.0993469-0.09138im      0.00439119+0.0471295im    -0.0346697-0.0703962im    -0.12558-0.00314003im    -0.0349038-0.0603984im
  0.0743438-0.0258102im     0.315868+0.0957056im   -0.0355995-0.0435331im   -0.0311592-0.112619im     0.0520634-0.0941425im     -0.360135+0.029608im       0.165345-0.0700065im     -0.020318+0.0631941im   -0.0762362-0.155415im      -0.212917-0.116423im      0.108117-0.0538376im   -0.000875478+0.0549594im      -0.358471-0.0869758im    -0.0616071+0.0563361im    -0.0383566-0.0879209im   0.00405842+0.0352im         -0.015352-0.209467im      0.0677966-0.220773im      0.0228385+0.109029im    -0.104703-0.0480846im    -0.034076-0.231049im       0.208206+0.0963457im     -0.106528-0.1098im      -0.0048846+0.195381im        0.025949+0.110766im       0.110928-0.0137817im     -0.0604614+0.043001im      0.0860885-0.0807839im    -0.0799584-0.0903952im     0.0934873+0.155737im   -0.0880289+0.0196033im      -0.178596-0.0702123im
 -0.0582601+0.193874im      0.058258-0.150563im    -0.0163094-0.0983579im   -0.0969889+0.0627791im     0.102608-0.0908053im   -0.00690308-0.0766725im     0.0134058+0.00790509im    -0.111316-0.157415im     0.0677444+0.0708231im     -0.135759+0.0342894im    0.0707204+0.355026im       -0.226281+0.258554im      -0.0844826-0.0255394im    -0.0245784+0.0516219im     0.0814989-0.048706im    -0.0748002+0.0377346im      -0.248764+0.0871154im    -0.0332058-0.0212395im    -0.0952888-0.118591im    0.0733071+0.28704im      0.0778757-0.10227im       0.0187675+0.191808im       0.053252-0.0801221im    0.0784983-0.129764im        0.100858-0.0389988im      0.110986-0.0377728im      -0.237431-0.0302848im    -0.0465449-0.0684245im     -0.149628+0.0270905im     -0.106969-0.283021im    -0.130992-0.214797im        0.063281+0.0524404im
 -0.0826422-0.0889854im   -0.0690736+0.0599821im    0.0445892+0.162353im      0.024011-0.110951im     0.0309194-0.175271im     -0.0984482-0.216434im     -0.0495075-0.0698327im     -0.179394-0.0371284im   -0.0580869-0.0249317im     0.0740971+0.0750791im    -0.125328-0.00107007im    -0.0243069+0.0176885im      -0.138825+0.154396im     -0.0908664-0.10507im         0.17734+0.145321im     0.0249282+0.0299346im      0.0610019+0.169994im      -0.164166-0.00914918im   -0.0470395+0.0427604im   -0.299791+0.038709im     0.0676489+0.0950501im     0.0962696-0.100167im     -0.0725001+0.0352746im    -0.207233+0.00814513im    -0.0259713-0.0960658im     0.0127162+0.0335567im      0.0909245-0.0199646im    -0.0168647+0.206644im      -0.213582-0.178636im       0.216525-0.0260533im   -0.400316+0.0164247im       0.268858-0.00952394im
  0.0440021+0.262616im      0.277667+0.00740297im    0.185434-0.121803im      0.133516+0.0601816im       0.1805-0.0731497im     0.0805391+0.193627im      0.0123444+0.129305im      -0.172274-0.266745im      0.190908+0.0991352im      0.210873-0.00420145im   -0.100942+0.102291im       0.0314486-0.184496im      -0.0654272+0.20998im      0.00436589+0.067165im       -0.13174+0.0164204im    0.0387784-0.0883914im        0.14686+0.183779im      -0.165179-0.0404317im    -0.0493143+0.0252158im   -0.126423-0.083841im    -0.0398367-0.0913176im      0.111956-0.038894im       0.112667+0.00743453im  -0.0293491-0.0148151im       -0.14693-0.0226971im      -0.16677+0.0316517im      -0.154363+0.173743im       0.101653-0.149652im    -0.00287018-0.153631im    -0.00871139+0.0895103im    0.108764-0.00852183im      -0.01579-0.160379im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.07816287928837065 - 0.07676648145916691im
  0.024086555073340198 - 0.08562059336123953im
  -0.06168816322391618 - 0.048476079573292676im
   0.04384415047777391 - 0.16654907306294287im
  0.011068723072152892 + 0.014075262170580092im
  -0.15280023901948997 + 0.1591582544355487im
  -0.14237337398947597 - 0.0668366352246072im
  -0.05330928660253865 + 0.13574440500410864im
   -0.1300773045984682 + 0.06265242856400591im
    0.1343584425122583 + 0.006326625931514215im
  -0.17509221824049573 + 0.06979314097253354im
  0.035147055673060645 - 0.1998117190541046im
  0.020900481184502585 + 0.0710482129869711im
   0.14071371696583573 - 0.13051684023281435im
  -0.05157749326007918 + 0.04576342536824174im
 -0.041241572459805156 - 0.0309422800562094im
   0.11852721506336714 - 0.09622192336604532im
   0.10910258188042488 + 0.08397771244368445im
 -0.006310135881849116 + 0.15773003194542926im
   0.16112156890105428 + 0.013834686685546035im
   0.12186963217571549 + 0.08756964964373733im
   0.06150889099687529 - 0.1899418918241155im
   0.17178073601253113 - 0.05974214427163715im
 0.0009658176835823096 + 0.21482216187783448im
 -0.012124772140594452 - 0.011420624526717806im
  -0.10648603976110968 + 0.06324322057556914im
  0.009700320993106738 - 0.023011229700385945im
   0.22380740547742578 - 0.179299846406552im
    0.3029681384585095 - 0.19383549779778556im
  -0.24375136565501968 + 0.11388298657560915im
 -0.020671896497289052 - 0.0480440063855474im
    0.3821046473010867 + 0.0im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 21 July 2025 07:38">Monday 21 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
