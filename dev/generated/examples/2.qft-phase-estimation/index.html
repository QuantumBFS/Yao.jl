<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  -0.0273018-0.0169246im    0.00129136+0.177041im       0.014224-0.0383448im     -0.159488+0.0352319im     0.0850387-0.159646im       0.0718424+0.0741628im    -0.0161981+0.0928648im    -0.0590432-0.0281637im        0.22103-0.0751278im    -0.0526133-0.0518306im     -0.300145-0.0248612im  -0.0135241-0.0959613im    0.107854+0.116735im    -0.00358275-0.0580423im     -0.311866-0.000866312im    0.0904879-0.235802im      -0.160213+0.0919903im   -0.0791944+0.0390187im       0.19264+0.0248859im   0.00734302+0.0369981im    0.0125129+0.0893888im      0.0543861-0.0112381im      -0.111977+0.0350675im   -0.0598279-0.183357im       0.0828087-0.0670951im      0.242157+0.0442848im      -0.199249-0.0896844im     0.213183-0.161223im      0.0496308-0.0537247im     -0.166789+0.333141im     0.0173229+0.138307im     -0.186635-0.0123532im
   -0.226423+0.00591873im    -0.330227-0.11405im      -0.0527626+0.210207im      0.0492089-0.108427im    -0.00577295+0.0465947im       0.126207-0.0698512im     -0.103405-0.0575356im      0.084526+0.081097im        0.143812+0.332373im     -0.0289287+0.0898211im     0.0493162+0.174488im   -0.0823398-0.113754im     -0.24152+0.0750631im     0.0857036+0.0727928im     0.0396201+0.0977676im     -0.0216914-0.0577419im    -0.0700969+0.099666im      0.135243+0.217214im    -0.00951424-0.0596362im   -0.0132553+0.0779171im     0.116493-0.286159im      -0.0817174-0.0937024im      -0.127504+0.0735452im    -0.164585+0.12878im      -0.00323403+0.000184811im   0.0955045+0.123825im       0.0292813+0.0638531im    0.0969001-0.0801279im      0.279206-0.00715367im    -0.061778+0.0322024im    0.0735454+0.100209im     0.0885881+0.112784im
  -0.0298856-0.182456im     -0.0804876-0.0866355im    -0.0186113+0.0309722im      0.127576+0.0196552im    -0.0139585-0.0350087im     -0.0220899+0.00115088im     -0.09193+0.15147im      -0.0738113-0.150016im       0.0740806-0.145074im     -0.0352303-0.0919111im     0.0137312-0.267959im   0.00529917-0.0157049im    0.205479-0.202778im    -0.00352809+0.125777im      -0.176575+0.0539154im      -0.157092+0.179429im     -0.0335964+0.0554679im     0.223643-0.10497im       0.0345444-0.0188707im     0.102868+0.106131im      0.179239-0.103998im      -0.0840581+0.222652im      -0.0504422-0.114651im     -0.052842-0.041992im        -0.22459+0.188692im       0.134903-0.122415im      -0.0045571+0.0637188im     0.266925+0.251185im       0.117846-0.139916im     -0.0394121-0.0523155im    0.0875089-0.144146im     0.0487341+0.19826im
  -0.0756945-0.0817965im     0.0491425-0.0845459im    -0.0258781-0.212681im      -0.394649-0.184879im       0.184265+0.142395im       0.0714347+0.0154968im      0.026579-0.00197145im   -0.0217121+0.239296im       -0.128064-0.00548278im    0.0403142-0.0418396im      0.121719+0.146075im    -0.142524+0.0229312im   0.0655976-0.140836im       0.153173+0.0965042im    -0.0873023+0.0390043im       0.185764-0.0261207im    -0.0122536+0.0895094im    0.0797318-0.0436329im      0.111968+0.0782469im   0.00691779-0.0511369im     0.139277+0.0132248im      -0.164336+0.251353im       0.0772169-0.157504im       0.28697+0.131088im       0.0813787-0.0630731im      0.152371-0.0768366im      0.0511863+0.0737404im    -0.166521-0.153105im      0.0986943-0.00130669im    -0.146842-0.059544im     0.0181545-0.0790677im   -0.0754809+0.149118im
   0.0848427+0.100087im     -0.0433834-0.118878im     -0.0802639-0.0627979im      0.114216-0.180666im     -0.0967576-0.309029im       -0.161541-0.0120588im     -0.212413+0.0914417im    -0.0387548-0.0422353im      -0.029936+0.310935im      0.0800951-0.153446im     -0.0424881+0.143351im   -0.0211783+0.0463331im     0.18819-0.14539im        0.119002+0.236463im       0.025233-0.0203253im      0.0527711-0.00205105im    -0.119953-0.107464im    -0.0513786+0.0872498im    -0.0560979-0.0441813im    -0.120648-0.0716407im    -0.223976+0.00730089im    -0.0309779+0.0488098im      0.0386973+0.0386611im     0.129233-0.177203im        0.109178-0.0177986im    -0.0141019-0.135864im      -0.0115616-0.289354im     0.0264457-0.110346im     -0.0553767-0.185259im       0.162792-0.0538769im      0.19834+0.0773621im    0.0331777+0.182749im
    0.106297-0.00539079im    0.0893776+0.000390377im    0.298809-0.134029im    -0.00338473+0.0280779im      0.108679-0.108741im      -0.0986942-0.055315im       0.126585-0.125087im     -0.0131202+0.0147769im       0.109669-0.0114054im    -0.0621596-0.196698im       0.142547-0.0804069im   -0.213898+0.0121527im   -0.199544-0.163777im        0.24568+0.380561im      0.0372849-0.0832098im     -0.0764029-0.00388727im   -0.0747925-0.0811887im    0.0117926+0.0021564im    -0.0317924-0.181969im     0.0656911-0.0370944im   0.00494796-0.000284091im     0.229863-0.221333im        0.135693+0.00398395im  -0.0726549+0.0461129im      0.0107865+0.0637882im     0.0505462+0.193204im      -0.0189427+0.211875im    -0.0392898+0.108835im      -0.130132-0.0827527im     -0.148473+0.175395im   -0.00915379+0.101302im    -0.0726063+0.126514im
 -0.00211677-0.251685im     -0.0766686+0.165612im      -0.106541+0.0168136im      0.226084-0.0322646im      0.213558-0.0225656im     -0.0334746-0.0312333im     -0.291982-0.117359im      0.0875412+0.174142im        0.129631-0.0634177im     -0.088303-0.0149994im    -0.0521764+0.0466583im   0.0527098-0.112914im    0.0319698+0.00707871im     0.115418+0.0615591im    -0.0508259-0.00321624im    -0.0728668-0.163086im      0.0619719+0.0948588im    -0.132781-0.171397im      -0.158188+0.112924im     0.0731587+0.12349im     -0.0803802+0.171348im      0.00619648-0.0179556im     -0.0545998+0.176257im    -0.0102531-0.0490475im      -0.169929+0.259084im     0.00213888-0.0359643im      0.0564959+0.0076541im    -0.269583-0.181748im     -0.0535661+0.0526325im     -0.056136-0.170305im      -0.25614+0.0304296im   -0.0279779+0.223692im
  -0.0132512-0.0578506im    0.00599063+0.152531im     -0.0497921+0.0809746im    -0.0100209+0.134006im      0.0449619+0.129092im      -0.0708213+0.073432im       0.179419-0.141661im      -0.318302-0.0965057im       0.196502+0.100904im      -0.231968+0.269721im     -0.0650528-0.0245828im  0.00552114+0.137921im    0.0539992+0.0632387im    0.00236867+0.191477im     -0.0260934+0.142665im       -0.115477-0.0115807im     -0.121951-0.0918954im   -0.0897432+0.0053468im     0.0286992+0.126531im      -0.30159-0.073233im     0.0560899-0.0523674im        0.10091+0.0639744im      0.0750138+0.0146467im     0.197454+0.00726945im    -0.0157472+0.251044im     -0.0492139-0.132654im       0.0579568+0.0245424im    -0.151547-0.000417099im   0.0866529+0.0984764im    -0.0709853-0.0348701im     0.330372+0.135374im     0.0409387-0.0658996im
    0.246174-0.070125im      0.0562052-0.364723im      -0.102581+0.0852468im      0.152823+0.102307im     -0.0942568-0.0467789im      0.0376863+0.0970383im    -0.0767046-0.0595909im    0.00522296-0.0315801im     -0.0104107-0.0462675im      0.113626-0.00882449im    -0.011641-0.0468886im   -0.132452+0.109542im    0.0699015-0.0119251im     0.0254281-0.103739im      0.0525138+0.146325im        0.175951+0.0925507im    -0.0102495+0.176444im      0.107096+0.00458233im    0.0499551+0.13633im      -0.107924+0.11308im      -0.155894-0.0617856im      0.0263905+0.191887im       -0.173096+0.181393im     0.0679435+0.232553im       0.0989778+0.127703im        0.10793+0.144093im       -0.208919+0.136232im     -0.162226+0.0354277im     -0.198238-0.0770206im     -0.176951+0.104517im   -0.00883538+0.252686im     0.0225521-0.10692im
   -0.125511+0.00722497im    0.0329291+0.14487im       -0.183916+0.154001im       0.140417+0.083487im     -0.0268319+0.099487im      -0.0530904+0.144595im      -0.132013+0.203075im      -0.142971-0.210661im       -0.059731-0.0935512im    -0.0212088-0.049785im     0.00459492+0.131548im     0.071061-0.128105im   -0.0628245-0.0537769im      0.263961-0.0792629im   -0.00375124+0.088407im       0.0314062-0.170314im      0.0874425-0.124977im      0.179266+0.0252802im      0.225577-0.116272im     -0.213138-0.128017im     0.0667611-0.0406739im     -0.0474153-0.193391im     -0.00676401-0.0548993im     0.239858+0.146123im       -0.042642-0.0374109im    -0.0419193+0.179259im       0.0972884+0.0241265im  0.000225544+0.0606382im     -0.162223-0.240443im    -0.00784424-0.0869977im    -0.132697-0.0338282im    -0.270902+0.0267056im
    0.021732-0.0738937im     0.0172384+0.195003im     0.00516007+0.101075im     -0.0408189+0.105967im       0.189552-0.0481322im      0.0721448+0.120916im     -0.0530386+0.00273809im   -0.0269851-0.0814095im      0.0917011+0.0494052im      0.200045-0.15026im       -0.203842-0.194569im    -0.254745+0.174642im     -0.15236-0.211796im       -0.18541+0.0702749im     -0.197355+0.165537im       0.0652299-0.0894989im     0.0655176-0.0592072im   -0.0284848+0.0365546im   -0.00410987-0.00494219im   -0.154006+0.225491im     -0.118894-0.0424749im       -0.21941-0.0617935im      0.0507988-0.0468476im    -0.170166+0.212012im        0.202321-0.210294im     -0.0913324-0.0690494im       0.165414-0.0311883im   -0.0489769+0.0653655im    -0.0704498+0.135588im      0.0608798-0.136605im    -0.0154035-0.0295214im     0.102189+0.0918493im
    0.187333+0.00983181im     0.145827-0.076878im      -0.137652-0.100484im     -0.0169206-0.143236im      -0.109574-0.0849945im      -0.174929-0.0760974im     0.0516244+0.212886im     -0.0916011+0.0855696im       0.137895-0.00508564im    0.0434045+0.28178im       -0.157558+0.0660881im    -0.16797-0.0165339im   -0.224991+0.121216im     -0.0539155-0.0520083im     -0.128467+0.0371891im       0.165805+0.120411im      0.0999295-0.0632154im    0.0631917-0.0465855im      0.155417-0.00111464im   0.0716573-0.0629355im    -0.240202-0.070237im        0.174832-0.0197633im     -0.0140293+0.140662im    -0.0664038-0.138181im       -0.205432-0.1434im        0.0413859-0.0175451im       0.176867+0.135844im    -0.0745201+0.173414im       0.182267+0.0645448im    -0.0887693-0.16843im     0.00855629-0.0496771im    -0.142817+0.206077im
  -0.0732481-0.0943358im   -0.00132737-0.0708471im    -0.0431245-0.0433277im     -0.113889+0.0776467im      0.157881-0.0688214im      0.0240761+0.0252038im    -0.0521556-0.0133127im      0.138027-0.0363597im    -0.00346665-0.00299454im    0.0332356+0.0426917im     -0.127801+0.220624im   -0.0335982-0.245144im    -0.163925-0.127803im      -0.199969-0.0378594im      0.067226+0.00520565im     -0.238343-0.0142243im     -0.279381+0.182073im     -0.121249-0.105207im     -0.0106634+0.0253179im   -0.0657045-0.151876im     -0.256081-0.0333636im      0.0966866-0.119276im        0.115424-0.101165im       0.12288+0.11924im       -0.0660595+0.0158936im      0.335347-0.0354833im      -0.137282+0.0198882im    0.0928323+0.192028im       -0.12703-0.0571071im     0.0133811-0.242967im     0.0776376-0.121981im      0.100694-0.165801im
   -0.201462+0.143086im       -0.12254+0.00125219im   -0.0846225-0.259363im       0.140796+0.136478im      -0.189829+0.0182459im       0.311683-0.173419im      0.0156924-0.0626889im     -0.207589-0.0404944im      0.0125079+0.0303499im      0.102554+0.0521146im     -0.032775+0.18027im     -0.246974+0.0718847im  -0.0496148-0.0200146im    -0.0587889-0.0692068im      -0.21426-0.337641im       0.0469756-0.06931im       -0.193191-0.0218416im   -0.0286248-0.194679im      0.0527478-0.024089im      0.133901+0.0964641im     0.134064+0.120024im     -0.00124584+0.0434154im     -0.0315413+0.0787169im   -0.0395524+0.079172im      0.00431297+0.10694im       -0.123921+0.0555459im      0.0819913-0.0973315im    -0.154346+0.147639im      -0.101565-0.193216im    -0.00457493-0.0470966im    0.0839489-0.0073109im    0.0348858-0.0121673im
  -0.0767205-0.0723549im    -0.0186682-0.0601474im    -0.0661774+0.0160729im     0.0538167-0.184128im     -0.0247598+0.0383622im     -0.0233652+0.0700754im    -0.0389278-0.10718im        0.175562+0.226092im        0.234641-0.267039im     -0.0344509-0.162688im     -0.0546967+0.0340944im   -0.208669-0.0521459im  -0.0315392+0.0415362im     -0.175593-0.0636904im     -0.151128-0.141096im       -0.138894+0.00136665im   -0.0355231-0.326493im     0.0377318+0.25142im     -0.00656211-0.163121im    -0.0930465-0.122968im    -0.0858212+0.00903965im     0.0704506+0.167116im       -0.268982-0.113198im      0.240048-0.00464967im     0.0455521+0.0777577im     -0.216335-0.00150487im   -0.00348231+0.205987im     0.0581806-0.0373474im    -0.0252083+0.00637627im     0.136557+0.0304105im    0.0319685+0.0060661im    0.0633329-0.0580116im
     0.14673+0.103779im     -0.0869806-0.187392im      0.0606614+0.00669353im   -0.0450353-0.0787049im   -0.00763461+0.000904452im     0.230489-0.00339734im   -0.0184557+0.088854im     -0.0135706-0.0522322im      -0.157511-0.0494063im     0.0473032+0.161723im      0.0327708-0.303822im   -0.0110916-0.0808476im   0.0606621-0.0172375im      0.160759+0.0720797im    -0.0875895+0.0205701im      -0.322814-0.233779im      0.0162461+0.0873084im    -0.313012-0.0203095im      0.110262+0.0375361im   0.00297834-0.133506im     -0.177385+0.0868668im      -0.116675-0.0520648im      -0.123176+0.158992im      0.106124+0.0950582im     -0.0906004-0.140983im      -0.255101+0.135985im       0.0683435+0.128846im       0.09062-0.119581im       0.073038-0.0421939im     -0.134634-0.0148193im     0.159921-0.132728im     0.0944996+0.0655252im
    0.115048+0.232198im      -0.125509+0.00465517im     0.218214-0.0417706im     -0.199531+0.0768398im     -0.211288-0.0543797im      -0.178867+0.0905775im      -0.14563-0.0888157im    -0.0566296+0.198007im      -0.0405784-0.0661316im    -0.0745382+0.192033im     -0.0374886-0.0340525im     0.25577-0.0454006im   -0.167226-0.0903412im     -0.175567+0.0894839im     -0.104218-0.054805im       0.0156072-0.0913904im    -0.0175355+0.105155im     0.0152185+0.164874im        0.15452-0.00997683im  -0.0501659+0.21355im      0.0818826+0.068837im       -0.109535+0.0449376im       0.114988+0.0781802im     0.162535+0.0175907im      -0.020813+0.0791594im    0.00279669-0.0735136im       0.100374+0.119843im      0.116335+0.0838855im    -0.0828334-0.181709im      0.0992867-0.0947807im    -0.234888+0.259725im      0.141116+0.0773996im
   -0.214574+0.0269012im      0.180602-0.188741im      0.0241652+0.132598im      -0.296778-0.0605422im     -0.146163+0.173657im       0.0132825+0.0639698im     -0.237507-0.0411654im     -0.120849-0.000593255im   0.00963299+0.0151332im      0.158719+0.0117036im     -0.124461-0.0968561im   -0.189193+0.167822im   -0.0876018+0.119601im       0.181015+0.147941im      0.0262868-0.0846788im      -0.181836-0.144638im       0.282921-0.0270428im    -0.140286-0.0746744im     -0.112438-0.00176775im  -0.0526591+0.072381im     0.0255222-0.0654078im       0.114963+0.142404im       0.0141397+0.0207928im    -0.118915-0.109015im      -0.0792984+0.108791im       0.167373+0.0425839im      -0.112698-0.0674027im    0.0649556+0.0340537im    -0.0368899-0.0217774im      0.243242-0.114505im    -0.0562122+0.0378766im    -0.177391-0.145286im
    0.106115-0.00539911im     0.148295+0.0847327im     -0.149989+0.183275im      0.0329803+0.0193247im     0.0841206-0.135498im        0.105768+0.146697im     -0.0772468-0.0313024im    0.00928177+0.0825621im      0.0348885+0.0826872im      0.133191+0.0506023im   -0.00944116-0.0365787im     0.17219+0.0758432im   -0.238787-0.0594547im    -0.0346711-0.0717387im    -0.0215004-0.11126im      -0.00452812+0.121621im    -0.00765982-0.122537im     -0.022437-0.149108im       -0.34374-0.140066im    -0.0118277-0.183861im      0.270573+0.191658im      -0.0726668+0.116059im       0.0917448+0.243306im     0.0138825+0.0141847im       0.102187-0.137672im       0.069917-0.107841im      -0.0554271+0.242352im     0.0828413-0.0705872im      0.127633-0.28289im       -0.129848-0.0289546im     0.143637+0.0211302im   -0.0868611-0.0427007im
   -0.140179+0.044602im      -0.116835+0.0129835im    -0.0894203+0.00622326im     0.111559+0.106918im      -0.205277+0.076671im        0.128249-0.0281004im     -0.109889+0.000947622im   0.0164234+0.311589im         -0.1194-0.131642im     -0.0737062-0.0669064im    -0.0213501-0.173527im     -0.05262+0.0499182im  -0.0938004-0.108649im     -0.0546522+0.12371im      0.00698389+0.0319442im     -0.0580309+0.0324222im    -0.0814341-0.178707im      0.161725-0.0995382im     0.0847643+0.129094im    -0.0834929-0.200487im     -0.247726-0.143631im       -0.281896-0.0815584im       0.319175+0.0233175im   -0.0828999-0.215003im      -0.0853673-0.0386956im    0.00501748-0.0872503im      -0.182262-0.0322424im    -0.122721-0.0332805im     0.0919334+0.0199856im     -0.175859+0.146055im    -0.0859998+0.0641184im   -0.0842091-0.142835im
   0.0474711-0.177094im     -0.0534752+0.106089im       0.138427-0.00823327im   -0.0872571+0.0216191im     -0.143935-0.276462im       -0.266243+0.0181534im     0.0795703+0.0377603im     0.0908786+0.0489901im      -0.285288+0.168553im       0.152287-0.0105275im     0.0490823+0.105968im     0.034961+0.0501546im   -0.160684+0.0929823im    -0.0258291-0.080874im      -0.253688+0.00579448im     -0.163781-0.0993276im     0.0305292-0.142259im      0.115381-0.228507im      0.0097333+0.114726im    -0.0284755+0.198825im     0.0133464-0.126246im      -0.0547833-0.0770498im     -0.0817264+0.0144824im     0.113419+0.105895im       0.0381624+0.255547im      -0.129245+0.0623708im      -0.235476+0.0497705im   -0.0263118-0.0541708im      0.101639+0.0763805im     0.0183687+0.0814347im     0.112425-0.210027im     -0.135869-0.0371188im
    0.118772+0.129308im     -0.0242578-0.0515396im     -0.196375-0.157787im     -0.0650721+0.00906162im    0.0323059+0.00425615im     0.0359172-0.150906im       0.249712+0.00355717im     0.122348-0.118556im        0.175142-0.193599im      0.0760685-0.223494im      -0.233774+0.141689im      0.08204-0.0654188im  -0.0351247+0.0289043im     0.0487779+0.110092im       0.221138-0.116261im      -0.0600649-0.075692im       0.142978+0.0896638im    0.0479936-0.193453im      0.0107475+0.155037im     -0.234844+0.0132704im     0.133784-0.149689im       -0.211377-0.00815097im     0.0500216+0.188265im     0.0568068-0.173658im        0.211163+0.103218im        -0.1052+0.116724im       -0.066496+0.10533im       0.130451+0.0856266im      0.101655+0.0900887im     0.0592394-0.0898367im   -0.0260619+0.0436968im     0.062311+0.15267im
    0.156862+0.202306im      -0.052253+0.0491377im      0.173768+0.134104im      0.0272064-0.0854164im     -0.206931+0.128042im        0.105901+0.042896im      0.0762227-0.278973im       0.254481-0.0211505im      0.0193947+0.0357761im     -0.103674+0.0229388im     -0.209761+0.177587im   -0.0903549-0.0978463im    0.130308-0.194987im       0.141694+0.00447223im    -0.165044+0.162022im       0.0628243+0.0667188im       0.25216-0.157328im    -0.0964658-0.115909im      -0.144761+0.0870453im    0.0318899+0.0628972im    0.0651048+0.0280516im      -0.074754-0.187627im       -0.194632-0.071707im      0.147329-0.0661136im     -0.0872379-0.090561im       0.155291-0.119238im     -0.00419528-0.0816632im   -0.0591245+0.224997im      0.0163443-0.0755502im     -0.145154+0.019238im     0.0476307-0.0408881im   -0.0013628-0.0547093im
   -0.287138+0.071225im      0.0483746-0.152704im      0.0045055-0.193528im      0.0740181-0.100118im      0.0129427+0.196292im       -0.474667-0.0579918im   -0.00845969-0.0390448im      0.043689-0.118882im      -0.0304004-0.00928831im     0.106938-0.0466712im     -0.163976-0.0821527im   0.0978538-0.0847921im   0.0239899+0.0354954im     0.0153277+0.00787203im    0.0343911-0.0249667im     -0.0810288-0.0945809im     -0.122778-0.0436593im  -0.00964526-0.00242063im  -0.00593411-0.185395im    -0.0821463+0.171128im      0.105461-0.0401585im     -0.0900152+0.0136237im      -0.101124+0.208489im    -0.0851152+0.0222387im     -0.0391699-0.210671im      0.0196828-0.246562im      0.00702819+0.0640699im    -0.151537-0.0363255im     -0.136629+0.0271539im     -0.332212+0.0338554im    0.0654884-0.0658034im     0.062002-0.124387im
  -0.0137258-0.0178003im    -0.0589461+0.157548im      0.0161104+0.0191587im      0.106059-0.0244389im     -0.010316+0.0369607im      -0.124868+0.0964741im     -0.112291-0.0498315im    0.00379801+0.0699034im     -0.0171349+0.0934889im      0.204186+0.149708im     -0.0963302+0.0841317im   -0.221366+0.218541im      0.18357-0.00922716im    0.0168028-0.0210986im      0.141239-0.0946635im      -0.203472+0.084728im     -0.0909839+0.0135779im     0.113237-0.206768im       0.111527+0.268496im    -0.0515342-0.0590955im     0.200949+0.014207im        0.220213-0.0736903im   -0.000206874-0.116295im     0.0913765+0.000498647im    -0.116181-0.360699im     -0.0736922+0.0441855im      -0.109708+0.122654im      0.182171-0.100738im     -0.0497351+0.0501058im   -0.00852223+0.0519156im     -0.17723+0.140778im      0.202604+0.146897im
   0.0481038-0.178739im       0.232961-0.187754im      0.0295916+0.117859im      -0.173568+0.0750937im     0.0466296+0.185512im     -0.00855093-0.2574im        -0.178162+0.0337243im    -0.0366007+0.0696285im      0.0832789+0.160902im      -0.225892-0.126792im     -0.0510992-0.01862im    -0.0921993-0.164781im    0.0545948+0.0403302im     0.0218064-0.10195im       -0.139275-0.00998706im    -0.0345002+0.202367im    -0.00389766+0.12378im       0.111142-0.220654im      0.0551612-0.154471im    -0.0452833+0.0941006im   -0.0142882+0.0885365im      0.0368316-0.2409im          0.114076+0.132482im      0.156761+0.0944035im      0.0835673-0.0560807im     -0.319677-0.138633im      -0.0396127-0.136539im     0.0929088+0.0230722im      0.146779-0.0569176im     0.0619761+0.0801857im   -0.0430729+0.127948im     0.0668496-0.0608958im
   -0.264761-0.0895034im    -0.0577055+0.151523im      0.0746496+0.0583291im   -0.00184513+0.0943333im     0.0514719+0.0647309im      0.0191679+0.0541808im      0.152434-0.184927im      0.0533636-0.0507464im      -0.122627-0.133759im       0.175271-0.0153334im        0.0581-0.0585618im   0.0735678-0.128143im     -0.12632+0.089019im       0.189184+0.0341896im     -0.171558-0.0490818im       0.178503+0.274176im      0.0160738+0.0722141im   -0.0793543+0.125958im      0.0280818-0.00112298im  -0.0162343-0.0630659im    -0.115906-0.0085417im     0.00925435+0.104332im       0.0119478+0.271189im      0.127835+0.0209264im      -0.177707-0.15403im      -0.0771313-0.0199149im       -0.32094-0.141713im     0.0368307+0.120566im     -0.0765879+0.0900236im      0.156121-0.0528738im      0.14087+0.131124im     0.0149782+0.292993im
   0.0540641+0.174875im      -0.119265-0.0853739im      0.219143+0.027186im    -0.00515325+0.132627im     -0.0885755-0.056596im       -0.134649+0.115509im      -0.292452-0.122103im     -0.0466664+0.0488766im        0.10324-0.114787im      -0.033511-0.150968im      0.0456081+0.030144im   -0.0238897-0.131057im    -0.140515+0.016271im      -0.115478-0.0569738im     0.0874129+0.0949346im    -0.00669879+0.132701im      0.0536961+0.0112663im   -0.0373619-0.275811im       0.230965-0.0750565im    -0.155067-0.281368im      0.176057+0.152397im       0.0320979+0.156404im      -0.0896878+0.0227982im    -0.145263+0.0980342im      0.0508967+0.0139317im     0.0580597+0.134266im       0.0989305-0.245461im    -0.0634622-0.0799936im     0.0394843+0.237396im     -0.0321504+0.0190391im      0.16954-0.134589im    -0.0249882+0.136361im
  0.00675791+0.0599823im      0.216784-0.160813im      0.0396335+0.0576538im       0.26182+0.0171238im       0.12912+0.125704im      -0.0130611+0.215314im       0.173393-0.0363497im       0.32864-0.0206512im      0.0378548+0.127419im      -0.217718+0.0774199im    -0.0433688-0.0355001im  -0.0962241+0.202715im    -0.143219-0.0453222im    -0.0483228+0.00436628im   -0.0888911-0.221724im      -0.0643934-0.0772064im     0.0902193+0.067315im      0.128231+0.123207im       0.289761+0.126218im     0.0732398-0.00369387im   0.0612702+0.0220291im     0.00586642+0.0256938im       0.169915+0.200097im     0.0516829+0.00410727im      0.019196+0.0877503im     0.0923207-0.0533208im      0.0133732-0.227084im     0.0862248-0.1786im       -0.0635733-0.0813676im     0.0347347-0.0161711im    0.0067633-0.247664im   -0.00777542+0.0641092im
   -0.101417-0.175625im       0.085883+0.144252im       0.148317-0.11597im       -0.122991+0.027307im     -0.0776384-0.0152324im      0.0840741+0.0509319im     -0.143526-0.0472697im     0.0453082+0.0439221im     -0.0327882+0.150398im      -0.214421+0.0792571im     -0.107313+0.193838im     0.126582+0.204249im     0.223346+0.00229863im    -0.134891-0.0222455im    0.00121166-0.183973im      -0.0346136-0.00170832im     0.242836+0.175434im     0.0664462+0.0688113im     -0.113259-0.177948im     -0.138175-0.192839im     -0.167085-0.183391im      -0.0761084+0.105432im      -0.0258047+0.0432193im     -0.14062+0.0240518im      0.0178641-0.00211822im    -0.159129+0.140805im      0.00625156+0.0525742im    0.0879767+0.159691im      -0.197015-0.00223068im    -0.307622+0.009201im     0.0535123-0.0620295im   -0.0407514+0.160563im
  0.00737853-0.0166944im   -0.00877448+0.0201758im     0.0369124+0.138979im     -0.0260871+0.123223im     -0.0403751-0.26181im         0.040177-0.047539im      0.0736867+0.0463112im      0.170307+0.15983im         0.115505+0.0923427im   -0.00915061+0.151078im     0.00900651+0.0280746im  -0.0827934-0.0517261im    0.291172-8.72372e-5im      0.29337+0.0778357im   -0.00343021-0.0322243im       0.133282-0.0353456im      -0.19389-0.145303im    -0.0446665-0.0838789im      0.147629-0.185533im     -0.010294-0.06595im       0.100956-0.0652665im      -0.129835+0.147709im       0.0746896+0.242382im    -0.0456676+0.121708im      -0.0422178+0.00569549im    0.0187724-0.0770796im      0.0951014+0.101657im      0.147286+0.0941374im     -0.145086+0.318796im        0.10676-0.124131im     -0.167581-0.083454im     -0.042515-0.259183im
   -0.088968+0.0265931im    -0.0741893+0.0647042im     -0.198948-0.301612im     -0.0593713-0.249418im      0.0156104-0.187051im        0.125071+0.0147325im      0.076671-0.16202im         0.13166+0.132515im       0.0607514+0.0265611im      -0.12825-0.0222093im      0.153434-0.149335im   -0.0117489-0.0199198im   0.0427737+0.0109355im    -0.0747546-0.119657im       0.128754+0.246318im       -0.105856+0.108111im       0.132385-0.107981im    -0.0381183-0.0692197im      0.135664+0.0419795im    -0.171234+0.255968im     0.0563902+0.0364468im       0.135353-0.023483im        0.106823+0.068388im      -0.11295+0.168367im       -0.126837-0.0437819im     -0.072636-0.000751107im  0.000667642-0.114075im      0.194215-0.0184562im     -0.138825-0.156602im     -0.0499566-0.137145im      0.123381+0.135706im     -0.265337-0.055347im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.10672241437799766 - 0.2795214948903833im
  -0.08493824444786507 - 0.041509002733116515im
   0.08177661695299653 - 0.20647232059825393im
  -0.11492360561586001 + 0.01915154622320487im
  -0.12193621223143392 - 0.2156357037164179im
   0.17369484175559913 + 0.12735910013535195im
   0.08457950666220437 - 0.03948219117983415im
   0.32286386513505083 + 0.0im
  0.038589498659482746 - 0.07239312468930396im
  -0.11206525347061108 + 0.062209141490846644im
   0.15723040739593747 + 0.02306961187814993im
 -0.003375622938735237 - 0.12492390762465885im
  -0.14497065900417708 + 0.04513626786543437im
  -0.15592244102656783 + 0.007235351015677224im
  -0.06091712387216242 + 0.13353903908187584im
   -0.0269345106423473 - 0.010980446215001072im
   0.11353854629566021 + 0.09428085045473224im
  -0.13642210731479718 + 0.09737496335491458im
  -0.21054210767776757 + 0.14519432676875113im
   -0.3068235281233613 + 0.08756996881225404im
   0.05639451374208529 - 0.03522082602094621im
   0.07030216617603155 + 0.0021607217451003607im
   0.14932050275331787 + 0.233587775003832im
   0.06419738010490955 - 0.13164813339411008im
  -0.08981428120340791 - 0.07653138095308379im
  -0.00629477058578603 - 0.02348057859456166im
  0.008782931074864789 - 0.16859495776929373im
   -0.1558916464600729 + 0.019473084443427227im
  -0.14003035175136613 + 0.014578129121907757im
  -0.08840078726069375 + 0.10082718457188683im
  -0.19026465853953697 - 5.314180560074544e-5im
  -0.12403634281799275 + 0.0473654468561318im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Wednesday 19 March 2025 04:53">Wednesday 19 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
